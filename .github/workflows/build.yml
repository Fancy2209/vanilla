name: Build
on:
  push:
    paths-ignore:
    - 'README.md'
  pull_request:
    paths-ignore:
    - 'README.md'
jobs:
  linux:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install build-essential \
          qt6-multimedia-dev libavcodec-dev libavfilter-dev libavutil-dev dhclient
    
    - name: Configure
      run: |
        mkdir build
        cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/AppDir/usr
    
    - name: Build
      run: |
        cd build
        cmake --build .
    
    - name: Deploy
      run: |
        cd build
        cmake --install .
        cd ..
        cp ../client/com.mattkc.* AppDir/
        curl -fLOSs https://github.com/AppImage/AppImageKit/releases/download/13/AppRun-x86_64
        mv AppRun-x86_64 AppDir/AppRun
        chmod +x AppDir/AppRun
        appimagetool AppDir
    
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.1
      with:
        path:
          Vanilla_U-x86_64.AppImage

      
